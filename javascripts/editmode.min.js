!function(m){var l=function(e,t){e.find(".image_settings").show(),e.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),t.removeClass("is-hidden").addClass("is-visible")},g=function(e,t){e.closest(".js-content-item-box").find(".top-inner").append('<div class="edy-img-drop-area-placeholder">'+t+"</div>"),e.closest(".js-content-item-box").find(".top-inner").attr("style",""),e.closest(".js-content-item-box").removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),e.closest(".js-content-item-box").find(".edy-img-drop-area").removeClass("active"),e.closest(".image_settings").hide(),e.closest(".js-content-item-box").find(".image_settings-remove--input").val(""),e.closest(".js-content-item-box").find(".image_settings-remove--input").trigger("change"),e.closest(".js-content-item-box").find(".form_field-cms").removeClass("with-input"),m(".image_settings").hide()};handleProductImage=function(a,e,i,t){m(".js-buy-btn-content  .partial .edy-buy-button-container").data("component-id");var s=m(".js-buy-btn-content  .partial .edy-buy-button-container").data("product-id"),o=m(".js-product-page-image .image-drop-area");m.ajax({type:"GET",contentType:"application/json",url:"/admin/api/pages/"+e,dataType:"json"}).then(function(t){i?t.data.item_image?(o.css("background-image","url("+t.data.item_image.url+")"),m(".js-remove-image").css("display","flex")):i.detail.product.image?(m(".image_settings").css("display","flex"),m(".js-remove-image").css("display","none"),m(".edy-img-drop-area-placeholder").remove(),l(o.closest(".js-content-item-box"),o.find(".js-toggle-crop-state")),o.css("background-image","url("+i.detail.product.image.url+")")):t.image?(o.css("background-image","url("+t.image.public_url+")"),m(".js-remove-image").css("display","flex")):g(m(".js-product-page-image .image-drop-area"),a):m.ajax({type:"GET",contentType:"application/json",url:"/admin/api/ecommerce/v1/products/"+s+"?include=details",dataType:"json"}).then(function(e){e.image?(m(".image_settings").css("display","flex"),m(".js-remove-image").css("display","none"),m(".edy-img-drop-area-placeholder").remove(),l(o.closest(".js-content-item-box"),o.find(".js-toggle-crop-state")),o.css("background-image","url("+e.image.url+")")):t.image?(o.css("background-image","url("+t.image.public_url+")"),m(".js-remove-image").css("display","flex")):g(m(".js-product-page-image .image-drop-area"),a)})})},window.site=m.extend(window.site||{},{bindContentItemImgDropAreas:function(d,r,c){m(".js-content-item-img-drop-area").each(function(e,t){var i=m(t),s=i.closest(".js-content-item-box"),t=s.find(".image_settings-remove"),a=s.data("item-id"),o=s.data("item-type"),n=(s.data("image-type"),new Edicy.CustomData({type:o,id:a}));new Edicy.ImgDropArea(i,{positionable:!1,target_width:2048,placeholder:'<div class="edy-img-drop-area-placeholder">'+d+"</div>",removeBtn:'<div class="edy-img-drop-area-remove-image"><div class="edy-img-drop-area-remove-image-ico"><svg width="16" height="20" viewBox="0 0 26 30" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="currentColor"><g transform="translate(2 5)"><path d="M0 .997h2V21c0 1 1 2 2 2h14c1 0 2-1 2-2V1h2v20c0 2.25-1.75 4-4 4H4c-2.25 0-4-1.75-4-4V.997z"/><rect x="10" y="4" width="2" height="16" rx="1"/><rect x="5" y="4" width="2" height="16" rx="1"/><rect x="15" y="4" width="2" height="16" rx="1"/></g><path d="M26 4v2H0V4h7V2c0-1 1-2 2-2h8c1 0 2 1 2 2v2h7zM9 4h8V3c0-.5-.5-1-1-1h-6c-.5 0-1 .5-1 1v1z"/></g></svg></div></div>',change:function(e){var t=s.find(".js-toggle-crop-state");i.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),e?(l(s,t),m(".js-remove-image").css("display","flex")):(s.find(".image_settings").hide(),s.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),t.addClass("is-hidden").removeClass("is-visible"),s.find(".edy-img-drop-area-placeholder").css("opacity",0));var a=s.data("item-type"),t=s.data("item-id");new Edicy.CustomData({type:a,id:t}).set({[c]:"not-cropped",[r]:e}),s.removeClass("not-loaded with-error").addClass("is-loaded"),s.find(".edy-img-drop-area-placeholder").css("opacity",1),i.css("opacity",1)}});t.on("click",function(){var t=m(this);n.get({success:function(e){e.item_image?n.remove(r,{success:function(e){n.remove(c,{success:function(e){"article"!==o?handleProductImage(d,a,null,n):g(t,d)}})}}):m.ajax({type:"PUT",contentType:"application/json",url:"/admin/api/pages/"+a,dataType:"json",data:JSON.stringify({image_id:null})}).then(function(e){g(t,d)})}})})})},bindContentItemImageCropToggle:function(i){m(".js-toggle-crop-state").on("click",function(){var e=m(this).closest(".js-content-item-box"),t=e.find(".js-content-item-img-drop-area"),a=e.data("item-id"),e=e.data("item-type"),a=new Edicy.CustomData({type:e,id:a}),t=t.hasClass("is-cropped")?(t.removeClass("is-cropped").addClass("not-cropped"),"not-cropped"):(t.removeClass("not-cropped").addClass("is-cropped"),"is-cropped");a.set(i,t)})},bindProductListeners:function(t,a){document.addEventListener("voog:ecommerce:buttonproductsave",function(e){handleProductImage(t,a,e)})}}),window.edy=window.edy||[],edy.push(["texteditorStyles",{name:"Button",tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}]),m(".js-data-item").each(function(){m(this).on("change",function(e){var t;t="checkbox"===e.target.type?e.target.checked:e.target.value;var a=e.target.dataset.name,i=e.target.dataset.id,s=e.target.dataset.entity,o=e.target.dataset.reload;("site"==s?new Edicy.CustomData({type:"site"}):new Edicy.CustomData({type:s,id:i})).set({[a]:t},{success:function(){o&&location.reload()}})})})}(jQuery);